<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dgit.mapper.ReservationMapper">

	<resultMap type="ReservationVO" id="reservationResult">
		<result property="res_no" column="res_no"></result>
		<result property="res_start" column="res_start"></result>
		<result property="res_end" column="res_end"></result>
	</resultMap>
	<resultMap type="ReservationVO" id="resHairStyleAndMember" extends="reservationResult">
		<result property="hairstyleVo.hair_no" column="hair_no"></result>
		<result property="hairstyleVo.hair_type" column="hair_type"></result>
		<result property="hairstyleVo.hair_price" column="hair_price"></result>
		<result property="member.u_id" column="u_id"></result>
	</resultMap>
	
	<!-- 예약된 리스트들 가져오기 -->
	<select id="selectAllReservation" parameterType="map" resultMap="resHairStyleAndMember">
		select * from reservation where res_start between #{res_start} and #{res_end}
		and  res_end between #{res_start} and #{res_end}
	</select>
	
	<!-- 예약 insert -->
	<insert id="insertReservation">
		insert into reservation(res_start, res_end, hair_no, u_id) values
		(#{res_start}, #{res_end}, #{hairstyleVo.hair_no}, #{member.u_id})	
	</insert>
	
	<!-- mypage 예약내역 -->
	<select id="myPageReservation" resultMap="resHairStyleAndMember">
		select r.res_start, r.res_end, r.hair_no, r.u_id, r.res_no, h.hair_type, h.hair_price 
		from reservation r 
		left join hair_style h on r.hair_no=h.hair_no
		where u_id=#{u_id}
		order by r.res_start desc
	</select>
	
	<!-- mypage 예약내역 페이징 -->
	<select id="myPageListCriteria" resultMap="resHairStyleAndMember">
		select r.res_start, r.res_end, r.hair_no, r.u_id, r.res_no, h.hair_type, h.hair_price 
		from reservation r 
		left join hair_style h on r.hair_no=h.hair_no
		where u_id=#{u_id}
		order by r.res_start desc limit #{pageStart}, #{perPageNum}
	</select>
	<select id="myPageTotalCount" resultType="int">
		select count(res_no) from reservation where u_id=#{u_id}
	</select>
	
	<!-- mypage 예약취소 -->
	<delete id="myPageDeleteReg">
		delete from reservation
		where u_id=#{u_id} and res_no=#{res_no}
	</delete>
</mapper>